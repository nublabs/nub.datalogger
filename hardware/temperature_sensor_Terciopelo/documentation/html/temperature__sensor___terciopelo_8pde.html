<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>temperature sensor: /Users/nikki/nublabs/nub.datalogger/hardware/temperature_sensor_Terciopelo/temperature_sensor_Terciopelo.pde File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.7 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>/Users/nikki/nublabs/nub.datalogger/hardware/temperature_sensor_Terciopelo/temperature_sensor_Terciopelo.pde File Reference</h1><code>#include &quot;<a class="el" href="name_8h-source.html">name.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="globals_8h-source.html">globals.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="communications__definitions_8h-source.html">communications_definitions.h</a>&quot;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>

<p>
<div class="dynheader">
Include dependency graph for temperature_sensor_Terciopelo.pde:</div>
<div class="dynsection">
<p><center><img src="temperature__sensor___terciopelo_8pde__incl.png" border="0" usemap="#/Users/nikki/nublabs/nub.datalogger/hardware/temperature_sensor_Terciopelo/temperature_sensor_Terciopelo.pde_map" alt=""></center>
<map name="/Users/nikki/nublabs/nub.datalogger/hardware/temperature_sensor_Terciopelo/temperature_sensor_Terciopelo.pde_map">
<area shape="rect" href="name_8h.html" title="name.h" alt="" coords="155,80,222,107"><area shape="rect" href="globals_8h.html" title="globals.h" alt="" coords="246,80,323,107"><area shape="rect" href="communications__definitions_8h.html" title="communications_definitions.h" alt="" coords="347,80,550,107"></map>
</div>

<p>
<a href="temperature__sensor___terciopelo_8pde-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#658c2878485cfe5cc625d283a6d34bc1">XBEE_SLEEP</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#b2de299215608c2a35f0feb86adc2f6f">SAMPLE_BUTTON</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#eb7a7ba1ab7e0406f1b5ab36d579f585">LED</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#2a2946288d28852ba343b09fd4f17d7a">SENSOR1_TOP</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#0da2a51dcb3e00b10aedd07d75f22382">SENSOR1_BOTTOM</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#645141ae2ab7fa7ac3f690c4959b6baf">SENSOR2_TOP</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#df66e6da6cf8c78004dc0a75fd14d3b1">SENSOR2_BOTTOM</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#4fc01d736fe50cf5b977f755b675f11d">setup</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#fe461d27b9c48d5921c00d521181f12f">loop</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#50a2ce599e896bfb535e70a42003ed23">sample</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#f8c68e93feeba5b9244094043672bac0">getByte</a> (int timeout)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#8f2521044963073c55b3c290fffd79e3">getMessage</a> (int timeout)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#95b1b253ee46df6a93285803cf1f3370">sendData</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">this function takes care of putting together a message string, calculating a checksum, sending it out to the computer and making sure the computer got it ok  <a href="#95b1b253ee46df6a93285803cf1f3370"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#465a79dc430d1e52a5b540920da744ca">getChecksum</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">this computes a checksum of the global string 'message'  <a href="#465a79dc430d1e52a5b540920da744ca"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#e369b3765489ee8bd0ea791c1843630f">configure</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><a class="el" href="applet_2nublogger_8h.html#e369b3765489ee8bd0ea791c1843630f" title="configure() runs if the computer is trying to change the sensor&#39;s sample rate...">configure()</a> runs if the computer is trying to change the sensor's sample rate  <a href="#e369b3765489ee8bd0ea791c1843630f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#3fdb2350c3f98c0de0f0ae3c831a8b14">discover</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function tells the computer of the datalogger's existence.  <a href="#3fdb2350c3f98c0de0f0ae3c831a8b14"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#b4dbd8380e5d93ead613cf38e6083b7f">waitForSampleInterval</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">this function waits for the time specified by the global variables 'hours,' 'minutes,' and 'seconds' It should ideally put the arduino in a power saving mode  <a href="#b4dbd8380e5d93ead613cf38e6083b7f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#f6c9587ccbcf223f8c79f508c2fef366">initializeSensor</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">this function configures all the digital communication pins as input or output pins  <a href="#f6c9587ccbcf223f8c79f508c2fef366"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#a06edc5122b70b3231ff87d8234fe759">xbeeSleep</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#884c5dd8e3bb500063c819db197db666">xbeeWake</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#ea28af0c7128421a38589128bb39ef1c">getTemperatures</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#cfc975251dbc3a8c9a9b11f8df62cc41">getRawData</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">this just grabs the raw values off the analog to digital converter  <a href="#cfc975251dbc3a8c9a9b11f8df62cc41"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#8e666a34a083b1806167ca991be0c436">convertToResistance</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">this function converts the raw ADC values from the thermistor into resistances of the thermistor  <a href="#8e666a34a083b1806167ca991be0c436"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#3aa4f99331713009a70ee34eba83754b">convertToTemperature</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#735577560ca40e5b6008a98829068904">R0</a> = 10000.0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#8188fea1f6709096fe21a3ee084d00d0">B</a> = 3950.0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#4211ba1269f650e21964d32238a460b2">T0</a> = 298</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="temperature__sensor___terciopelo_8pde.html#d17df5990b551ac9e97a3d60f65833ff">RBOTTOM</a> = 1000.0</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="eb7a7ba1ab7e0406f1b5ab36d579f585"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::LED" ref="eb7a7ba1ab7e0406f1b5ab36d579f585" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LED&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00330">330</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

</div>
</div><p>
<a class="anchor" name="b2de299215608c2a35f0feb86adc2f6f"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::SAMPLE_BUTTON" ref="b2de299215608c2a35f0feb86adc2f6f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SAMPLE_BUTTON&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00329">329</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

</div>
</div><p>
<a class="anchor" name="0da2a51dcb3e00b10aedd07d75f22382"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::SENSOR1_BOTTOM" ref="0da2a51dcb3e00b10aedd07d75f22382" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SENSOR1_BOTTOM&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00333">333</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

</div>
</div><p>
<a class="anchor" name="2a2946288d28852ba343b09fd4f17d7a"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::SENSOR1_TOP" ref="2a2946288d28852ba343b09fd4f17d7a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SENSOR1_TOP&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00332">332</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

</div>
</div><p>
<a class="anchor" name="df66e6da6cf8c78004dc0a75fd14d3b1"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::SENSOR2_BOTTOM" ref="df66e6da6cf8c78004dc0a75fd14d3b1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SENSOR2_BOTTOM&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00335">335</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

</div>
</div><p>
<a class="anchor" name="645141ae2ab7fa7ac3f690c4959b6baf"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::SENSOR2_TOP" ref="645141ae2ab7fa7ac3f690c4959b6baf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SENSOR2_TOP&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00334">334</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

</div>
</div><p>
<a class="anchor" name="658c2878485cfe5cc625d283a6d34bc1"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::XBEE_SLEEP" ref="658c2878485cfe5cc625d283a6d34bc1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XBEE_SLEEP&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
these are the pin definitions for the v2 board<p>
function atmega pin arduino pin<p>
Serial RX PD0 0 //serial lines that go out to the xbee module Serial TX PD1 1 Xbee_sleep PD2 2 //a pin that, when asserted, puts the xbee radio into a low power sleep mode Sample_button PD3 3 //an optional button that forces the sensor to take and send out a measurement LED PD4 4 //an LED on board that you can use for all kinds of stuff<p>
sensor1_top PC0 (analog) 0 sensor1_bottom PC1 (analog) 1 sensor2_top PC2 (analog) 2 sensor2_bottom PC3 (analog) 3 
<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00328">328</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="e369b3765489ee8bd0ea791c1843630f"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::configure" ref="e369b3765489ee8bd0ea791c1843630f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void configure           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<a class="el" href="applet_2nublogger_8h.html#e369b3765489ee8bd0ea791c1843630f" title="configure() runs if the computer is trying to change the sensor&#39;s sample rate...">configure()</a> runs if the computer is trying to change the sensor's sample rate 
<p>
In <a class="el" href="applet_2nublogger_8h.html#e369b3765489ee8bd0ea791c1843630f" title="configure() runs if the computer is trying to change the sensor&#39;s sample rate...">configure()</a>, the datalogger sends a LISTENING message to the computer, indicating that it's ready to receive data. The computer sends three ints: the hours, minutes and seconds of the sample interval, followed by a checksum byte that's the sum of the ints modulo 256. The sensor computes a checksum on the received data. If its checksum matches, it sends an ACKNOWLEDGE message back to the computer and updates its sample interval information. If the checksum does not match, it sends a CHECKSUM_ERROR_PLEASE_RESEND message, asking the computer to send the three ints again, followed by a checksum. If the sensor can't get a valid message (with a matching checksum) after three tries, it gives up, sends a CHECKSUM_ERROR_GIVING_UP message to the computer and keeps its original sample interval information 
<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00190">190</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="applet_2globals_8h-source.html#l00020">buffer</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00029">CHECKSUM</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00013">CHECKSUM_ERROR_GIVING_UP</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00012">CHECKSUM_ERROR_PLEASE_RESEND</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00030">CONFIGURATION_MESSAGE_LENGTH</a>, <a class="el" href="applet_2globals_8h-source.html#l00008">configured</a>, <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00127">getMessage()</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00023">HOUR_HIGH</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00024">HOUR_LOW</a>, <a class="el" href="applet_2globals_8h-source.html#l00011">hours</a>, <a class="el" href="applet_2globals_8h-source.html#l00021">index</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00011">LISTENING</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00017">MALFORMED_MESSAGE_ERROR_GIVING_UP</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00016">MALFORMED_MESSAGE_ERROR_PLEASE_RESEND</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00020">MESSAGE_START</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00025">MINUTE_HIGH</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00026">MINUTE_LOW</a>, <a class="el" href="applet_2globals_8h-source.html#l00012">minutes</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00006">NUM_TRIES</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00027">SECOND_HIGH</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00028">SECOND_LOW</a>, <a class="el" href="applet_2globals_8h-source.html#l00013">seconds</a>, <a class="el" href="applet_2globals_8h-source.html#l00022">start</a>, and <a class="el" href="applet_2communications__definitions_8h-source.html#l00015">TIMEOUT_ERROR</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00191"></a>00191 { 
<a name="l00192"></a>00192   <span class="keywordtype">char</span> i=0;
<a name="l00193"></a>00193   <span class="keywordtype">char</span> tries=0;
<a name="l00194"></a>00194   <span class="keywordtype">char</span> success=0;
<a name="l00195"></a>00195   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> checksum=0;
<a name="l00196"></a>00196   <span class="keywordtype">int</span> error;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198   <span class="keywordflow">while</span>((tries&lt;<a class="code" href="applet_2communications__definitions_8h.html#1685ca2e434799fb98ea9272ed39d5e3">NUM_TRIES</a>)&amp;&amp;(success==0))     <span class="comment">//we'll try</span>
<a name="l00199"></a>00199   {
<a name="l00200"></a>00200     checksum=0;
<a name="l00201"></a>00201     Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#29d0028b064fb993c0e1f2b1ce4a7f88">LISTENING</a>,BYTE);
<a name="l00202"></a>00202     error=<a class="code" href="temperature__sensor___terciopelo_8cpp.html#8f2521044963073c55b3c290fffd79e3">getMessage</a>(100);
<a name="l00203"></a>00203     <span class="keywordflow">if</span>(error==-1)
<a name="l00204"></a>00204       Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#efc48d416c882f06edaf6d01779d4d74">TIMEOUT_ERROR</a>,BYTE);
<a name="l00205"></a>00205     <span class="keywordflow">else</span>
<a name="l00206"></a>00206     {
<a name="l00207"></a>00207       <span class="keywordflow">if</span>(<a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>]==<a class="code" href="applet_2communications__definitions_8h.html#53b51d504d04d1bbfb3d4a4f57349480">MESSAGE_START</a>)
<a name="l00208"></a>00208       {
<a name="l00209"></a>00209         <span class="keywordflow">if</span>((<a class="code" href="applet_2globals_8h.html#5abc5420a7f15af7410173395b610ea8">index</a>-<a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>)==<a class="code" href="applet_2communications__definitions_8h.html#8ec36de1ede672b53100e0414d57a75a">CONFIGURATION_MESSAGE_LENGTH</a>)    <span class="comment">//check to make sure the message is the size we expect</span>
<a name="l00210"></a>00210         {
<a name="l00211"></a>00211           <span class="keywordflow">for</span>(i=1;i&lt;<a class="code" href="applet_2communications__definitions_8h.html#9886586c91a412164c69eb0270d2875e">CHECKSUM</a>;i++)
<a name="l00212"></a>00212             checksum+=<a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>+i];
<a name="l00213"></a>00213           <span class="keywordflow">if</span>(checksum==<a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>+CHECKSUM])    <span class="comment">//check to see if the calculated checksum is the same as the received checksum</span>
<a name="l00214"></a>00214           {
<a name="l00215"></a>00215             <span class="comment">//if it is, then we can load all the sample interval info</span>
<a name="l00216"></a>00216             <a class="code" href="applet_2globals_8h.html#f23005df06fc3cd4264e5eee2dfa2f8c">hours</a>=(int)<a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>+<a class="code" href="applet_2communications__definitions_8h.html#d82632844d46de002b8d8d16900e42a0">HOUR_HIGH</a>]*256+(<span class="keywordtype">int</span>)<a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>+<a class="code" href="applet_2communications__definitions_8h.html#3faa4fcb5d61433ccf65f19b4de44703">HOUR_LOW</a>];
<a name="l00217"></a>00217             <a class="code" href="applet_2globals_8h.html#b693b677bdc9ded12b06daf49778101c">minutes</a>=(int)<a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>+<a class="code" href="applet_2communications__definitions_8h.html#592fee6a2134a20e8761668cb7c773e3">MINUTE_HIGH</a>]*256+(<span class="keywordtype">int</span>)<a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>+<a class="code" href="applet_2communications__definitions_8h.html#2ace92e75321bdd463da760570b4e7e7">MINUTE_LOW</a>];
<a name="l00218"></a>00218             <a class="code" href="applet_2globals_8h.html#77bd4f876bdc3afed5acdd936f775d34">seconds</a>=(int)<a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>+<a class="code" href="applet_2communications__definitions_8h.html#f4364f097130bbbe71669acfee2692ae">SECOND_HIGH</a>]*256+(<span class="keywordtype">int</span>)<a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>+<a class="code" href="applet_2communications__definitions_8h.html#15e121356786cb610493f80e4b35e677">SECOND_LOW</a>];
<a name="l00219"></a>00219             success=1;         <span class="comment">//we can stop looping</span>
<a name="l00220"></a>00220             <a class="code" href="applet_2globals_8h.html#7bfacbf7b939bc01bfe63d7a2fdb0ad8">configured</a>=1;      <span class="comment">//the sensor is configured!</span>
<a name="l00221"></a>00221           }
<a name="l00222"></a>00222           <span class="keywordflow">else</span>
<a name="l00223"></a>00223           {
<a name="l00224"></a>00224             <span class="keywordflow">if</span>(tries&lt;<a class="code" href="applet_2communications__definitions_8h.html#1685ca2e434799fb98ea9272ed39d5e3">NUM_TRIES</a>)
<a name="l00225"></a>00225             {
<a name="l00226"></a>00226               Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#d7285ac8b394b259876f0e61574dd8b0">CHECKSUM_ERROR_PLEASE_RESEND</a>);
<a name="l00227"></a>00227               tries++;
<a name="l00228"></a>00228             }
<a name="l00229"></a>00229             <span class="keywordflow">else</span>
<a name="l00230"></a>00230               Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#b111ad1c600abfe6a9a3a7e7a1a057d5">CHECKSUM_ERROR_GIVING_UP</a>);
<a name="l00231"></a>00231           }
<a name="l00232"></a>00232         }
<a name="l00233"></a>00233         <span class="keywordflow">else</span>      <span class="comment">//the message is the wrong size</span>
<a name="l00234"></a>00234         {
<a name="l00235"></a>00235           <span class="keywordflow">if</span>(tries&lt;<a class="code" href="applet_2communications__definitions_8h.html#1685ca2e434799fb98ea9272ed39d5e3">NUM_TRIES</a>)
<a name="l00236"></a>00236           {
<a name="l00237"></a>00237             Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#c4da90313e5d11e20acac66663fb014c">MALFORMED_MESSAGE_ERROR_PLEASE_RESEND</a>);
<a name="l00238"></a>00238             tries++;
<a name="l00239"></a>00239           }
<a name="l00240"></a>00240           <span class="keywordflow">else</span>
<a name="l00241"></a>00241             Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#bf39c03638711128272afb73031f864d">MALFORMED_MESSAGE_ERROR_GIVING_UP</a>);
<a name="l00242"></a>00242         }
<a name="l00243"></a>00243       }
<a name="l00244"></a>00244       <span class="keywordflow">else</span>
<a name="l00245"></a>00245       {
<a name="l00246"></a>00246         <span class="keywordflow">if</span>(tries&lt;<a class="code" href="applet_2communications__definitions_8h.html#1685ca2e434799fb98ea9272ed39d5e3">NUM_TRIES</a>)
<a name="l00247"></a>00247         {
<a name="l00248"></a>00248           Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#c4da90313e5d11e20acac66663fb014c">MALFORMED_MESSAGE_ERROR_PLEASE_RESEND</a>);
<a name="l00249"></a>00249           tries++;
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251         <span class="keywordflow">else</span>
<a name="l00252"></a>00252           Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#bf39c03638711128272afb73031f864d">MALFORMED_MESSAGE_ERROR_GIVING_UP</a>);
<a name="l00253"></a>00253       }
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255   }
<a name="l00256"></a>00256 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8e666a34a083b1806167ca991be0c436"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::convertToResistance" ref="8e666a34a083b1806167ca991be0c436" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void convertToResistance           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
this function converts the raw ADC values from the thermistor into resistances of the thermistor 
<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00390">390</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00359">RBOTTOM</a>, <a class="el" href="applet_2globals_8h-source.html#l00026">sensor1_bottom</a>, <a class="el" href="applet_2globals_8h-source.html#l00031">sensor1_resistance</a>, and <a class="el" href="applet_2globals_8h-source.html#l00025">sensor1_top</a>.</p>

<p>Referenced by <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00389">getTemperatures()</a>, and <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00103">sample()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00391"></a>00391 {
<a name="l00392"></a>00392   <a class="code" href="applet_2globals_8h.html#02e4140abf2d38e2f54630353cc82c4d">sensor1_resistance</a> = ((float)<a class="code" href="applet_2globals_8h.html#eb723e2da6dfcdda2972ff176b4aade2">sensor1_top</a>/(<span class="keywordtype">float</span>)<a class="code" href="applet_2globals_8h.html#c0cf7a4f555cb76b1b42a5ec73a1f582">sensor1_bottom</a> - 1)*<a class="code" href="temperature__sensor___terciopelo_8cpp.html#d17df5990b551ac9e97a3d60f65833ff">RBOTTOM</a>; <span class="comment">// Voltages converted to resistances</span>
<a name="l00393"></a>00393   <span class="comment">/* uncomment if I enable two sensing elements</span>
<a name="l00394"></a>00394 <span class="comment">   sensor2_resistance = ((float)sensor2_top/(float)sensor2_bottom - 1)*RBOTTOM; // Voltages converted to resistances*/</span>
<a name="l00395"></a>00395    <span class="keywordtype">int</span> a=(int) <a class="code" href="applet_2globals_8h.html#02e4140abf2d38e2f54630353cc82c4d">sensor1_resistance</a>;
<a name="l00396"></a>00396    Serial.println(<span class="stringliteral">"woohoo!"</span>);
<a name="l00397"></a>00397 <span class="comment">//  Serial.println(a,DEC);</span>
<a name="l00398"></a>00398 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3aa4f99331713009a70ee34eba83754b"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::convertToTemperature" ref="3aa4f99331713009a70ee34eba83754b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void convertToTemperature           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00401">401</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00357">B</a>, <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00356">R0</a>, <a class="el" href="applet_2globals_8h-source.html#l00031">sensor1_resistance</a>, <a class="el" href="applet_2globals_8h-source.html#l00035">sensor1_temperature</a>, and <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00358">T0</a>.</p>

<p>Referenced by <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00389">getTemperatures()</a>, and <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00103">sample()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00402"></a>00402 {
<a name="l00403"></a>00403   <a class="code" href="applet_2globals_8h.html#bffcded031596e15ce3964ab6ebe4f29">sensor1_temperature</a> = float(<a class="code" href="temperature__sensor___terciopelo_8cpp.html#8188fea1f6709096fe21a3ee084d00d0">B</a>/log(<a class="code" href="applet_2globals_8h.html#02e4140abf2d38e2f54630353cc82c4d">sensor1_resistance</a>/(<a class="code" href="temperature__sensor___terciopelo_8cpp.html#735577560ca40e5b6008a98829068904">R0</a>*exp(-1.0*<a class="code" href="temperature__sensor___terciopelo_8cpp.html#8188fea1f6709096fe21a3ee084d00d0">B</a>/<a class="code" href="temperature__sensor___terciopelo_8cpp.html#4211ba1269f650e21964d32238a460b2">T0</a>))) - 273.0); <span class="comment">// Temperature in degrees Celsius</span>
<a name="l00404"></a>00404   <span class="comment">/* uncomment if I enable two sensing elements</span>
<a name="l00405"></a>00405 <span class="comment">   sensor2_temperature = float(B/log(sensor2_resistance/(R0*exp(-1.0*B/T0))) - 273.0); // Temperature in degrees Celsius   */</span>
<a name="l00406"></a>00406 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3fdb2350c3f98c0de0f0ae3c831a8b14"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::discover" ref="3fdb2350c3f98c0de0f0ae3c831a8b14" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void discover           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function tells the computer of the datalogger's existence. 
<p>
When the sensor turns on, it runs <a class="el" href="applet_2nublogger_8h.html#3fdb2350c3f98c0de0f0ae3c831a8b14" title="This function tells the computer of the datalogger&#39;s existence.">discover()</a>. It sends a MESSAGE_START message, a DISCOVER_ME message, and its name out to the computer and waits for acknowledgement. The computer can send back a plain "ACKNOWLEDGE" message, which means that the sensor should run using its default configuration values. The computer can also send back an "ACKNOWLEDGE_AND_CONFIGURE" message, which means that it has configuration data for the sensor. If the sensor gets this message, it'll run <a class="el" href="applet_2nublogger_8h.html#e369b3765489ee8bd0ea791c1843630f" title="configure() runs if the computer is trying to change the sensor&#39;s sample rate...">configure()</a> to receive the data from the computer. 
<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00267">267</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="applet_2communications__definitions_8h-source.html#l00009">ACKNOWLEDGE</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00010">ACKNOWLEDGE_AND_CONFIGURE</a>, <a class="el" href="applet_2nublogger_8h-source.html#l00015">configure()</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00014">DISCOVER_ME</a>, <a class="el" href="applet_2globals_8h-source.html#l00007">discovered</a>, <a class="el" href="applet_2communications_8h-source.html#l00004">getByte()</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00021">MESSAGE_END</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00020">MESSAGE_START</a>, <a class="el" href="applet_2name_8h-source.html#l00001">name</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00015">TIMEOUT_ERROR</a>, and <a class="el" href="applet_2globals_8h-source.html#l00002">TRUE</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00268"></a>00268 { 
<a name="l00269"></a>00269   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> checksum=0;
<a name="l00270"></a>00270   <span class="keywordtype">int</span> i=0;
<a name="l00271"></a>00271   Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#53b51d504d04d1bbfb3d4a4f57349480">MESSAGE_START</a>, BYTE);
<a name="l00272"></a>00272   Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#9413ad5afdb7d48c2d8606409cde00d0">DISCOVER_ME</a>,BYTE);
<a name="l00273"></a>00273   Serial.print(<a class="code" href="applet_2name_8h.html#5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00274"></a>00274   <span class="keywordflow">while</span>(<a class="code" href="applet_2name_8h.html#5ac083a645d964373f022d03df4849c8">name</a>[i]!=0)
<a name="l00275"></a>00275   {
<a name="l00276"></a>00276     checksum+=<a class="code" href="applet_2name_8h.html#5ac083a645d964373f022d03df4849c8">name</a>[i];
<a name="l00277"></a>00277     i++;
<a name="l00278"></a>00278   }
<a name="l00279"></a>00279   checksum+=<a class="code" href="applet_2communications__definitions_8h.html#9413ad5afdb7d48c2d8606409cde00d0">DISCOVER_ME</a>;
<a name="l00280"></a>00280   Serial.print(checksum,BYTE);
<a name="l00281"></a>00281   Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#012714d5d0e7065e355fefe979491541">MESSAGE_END</a>,BYTE);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   <span class="keywordtype">int</span> receivedByte=<a class="code" href="applet_2communications_8h.html#f8c68e93feeba5b9244094043672bac0">getByte</a>(100);     <span class="comment">//looks for a byte on the serial port with a 100ms timeout</span>
<a name="l00284"></a>00284   <span class="keywordflow">if</span>(receivedByte==<a class="code" href="applet_2communications__definitions_8h.html#d97232eed56f4b8962167188db8dd2d4" title="these are defined messages sent between the sensor and the computer">ACKNOWLEDGE</a>)
<a name="l00285"></a>00285     <a class="code" href="applet_2globals_8h.html#514585400668872c199fe503d6259b83">discovered</a>=<a class="code" href="applet_2globals_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00286"></a>00286   <span class="keywordflow">if</span>(receivedByte==<a class="code" href="applet_2communications__definitions_8h.html#421ea5726b2e7e3464457785964b3c11">ACKNOWLEDGE_AND_CONFIGURE</a>)
<a name="l00287"></a>00287   {
<a name="l00288"></a>00288     <a class="code" href="applet_2globals_8h.html#514585400668872c199fe503d6259b83">discovered</a>=<a class="code" href="applet_2globals_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00289"></a>00289     <a class="code" href="applet_2nublogger_8h.html#e369b3765489ee8bd0ea791c1843630f" title="configure() runs if the computer is trying to change the sensor&amp;#39;s sample rate...">configure</a>();
<a name="l00290"></a>00290   }
<a name="l00291"></a>00291   <span class="keywordflow">if</span>(receivedByte==-1)
<a name="l00292"></a>00292   {
<a name="l00293"></a>00293     Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#efc48d416c882f06edaf6d01779d4d74">TIMEOUT_ERROR</a>,BYTE);  <span class="comment">//getByte didn't get a byte before the timeout</span>
<a name="l00294"></a>00294   }  
<a name="l00295"></a>00295 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f8c68e93feeba5b9244094043672bac0"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::getByte" ref="f8c68e93feeba5b9244094043672bac0" args="(int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int getByte           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00096">96</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00097"></a>00097 {
<a name="l00098"></a>00098   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> currentTime=millis();
<a name="l00099"></a>00099   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> maxTime=currentTime+timeout;
<a name="l00100"></a>00100   <span class="keywordflow">while</span>((Serial.available()==0)&amp;&amp;(millis()&lt;(maxTime)))
<a name="l00101"></a>00101   {
<a name="l00102"></a>00102   }
<a name="l00103"></a>00103   <span class="keywordflow">if</span>(Serial.available()&gt;0)        <span class="comment">//did any data come in on the serial port?</span>
<a name="l00104"></a>00104     <span class="keywordflow">return</span> Serial.read();
<a name="l00105"></a>00105   <span class="keywordflow">else</span>                             <span class="comment">//we didn't get any data before the timeout</span>
<a name="l00106"></a>00106   <span class="keywordflow">return</span> -1;
<a name="l00107"></a>00107 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="465a79dc430d1e52a5b540920da744ca"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::getChecksum" ref="465a79dc430d1e52a5b540920da744ca" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char getChecksum           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
this computes a checksum of the global string 'message' 
<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00166">166</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="applet_2globals_8h-source.html#l00005">message</a>.</p>

<p>Referenced by <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00151">sendData()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00167"></a>00167 {
<a name="l00168"></a>00168   <span class="keywordtype">char</span> i=0;
<a name="l00169"></a>00169   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> checksum=0;
<a name="l00170"></a>00170   <span class="keywordflow">while</span>(<a class="code" href="applet_2globals_8h.html#a0ec8ae62320ddf9e7b3d84d4cf01522">message</a>[i]!=0)
<a name="l00171"></a>00171   {
<a name="l00172"></a>00172     checksum+=<a class="code" href="applet_2globals_8h.html#a0ec8ae62320ddf9e7b3d84d4cf01522">message</a>[i];
<a name="l00173"></a>00173     i++;
<a name="l00174"></a>00174   }
<a name="l00175"></a>00175   <span class="keywordflow">return</span> checksum;
<a name="l00176"></a>00176 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8f2521044963073c55b3c290fffd79e3"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::getMessage" ref="8f2521044963073c55b3c290fffd79e3" args="(int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int getMessage           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00109">109</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="applet_2globals_8h-source.html#l00020">buffer</a>, <a class="el" href="applet_2globals_8h-source.html#l00021">index</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00021">MESSAGE_END</a>, and <a class="el" href="applet_2globals_8h-source.html#l00022">start</a>.</p>

<p>Referenced by <a class="el" href="applet_2temperature__sensor___terciopelo_8pde-source.html#l00190">configure()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00110"></a>00110 {
<a name="l00111"></a>00111   <span class="keywordtype">int</span> completeMessage=-1;   <span class="comment">//a flag that lets us know if we got a full message</span>
<a name="l00112"></a>00112   <a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>=<a class="code" href="applet_2globals_8h.html#5abc5420a7f15af7410173395b610ea8">index</a>;              <span class="comment">//drop whatever other data is in our buffer--it'll probably just confuse the functions if we don't</span>
<a name="l00113"></a>00113   <span class="keywordtype">int</span> currentTime=millis();
<a name="l00114"></a>00114   <span class="keywordtype">int</span> maxTime=currentTime+timeout;  
<a name="l00115"></a>00115   <span class="keywordflow">while</span>((millis()&lt;(maxTime))&amp;&amp;(<a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#5abc5420a7f15af7410173395b610ea8">index</a>]!=<a class="code" href="applet_2communications__definitions_8h.html#012714d5d0e7065e355fefe979491541">MESSAGE_END</a>))
<a name="l00116"></a>00116   {
<a name="l00117"></a>00117     <span class="keywordflow">if</span>(Serial.available()&gt;0)
<a name="l00118"></a>00118     {
<a name="l00119"></a>00119       <a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#5abc5420a7f15af7410173395b610ea8">index</a>]=Serial.read();
<a name="l00120"></a>00120       <span class="keywordflow">if</span>(<a class="code" href="applet_2globals_8h.html#d5e2d3a85512c52e869f6ad9a4c2808e">buffer</a>[<a class="code" href="applet_2globals_8h.html#5abc5420a7f15af7410173395b610ea8">index</a>]==<a class="code" href="applet_2communications__definitions_8h.html#012714d5d0e7065e355fefe979491541">MESSAGE_END</a>)   <span class="comment">//we got a complete message</span>
<a name="l00121"></a>00121         completeMessage=1;
<a name="l00122"></a>00122       <a class="code" href="applet_2globals_8h.html#5abc5420a7f15af7410173395b610ea8">index</a>++;
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124   }
<a name="l00125"></a>00125   <span class="keywordflow">if</span>(completeMessage==-1)    <span class="comment">//we never got a complete message</span>
<a name="l00126"></a>00126     <a class="code" href="applet_2globals_8h.html#0558edb7889eddddb3a01e3956de01c4">start</a>=<a class="code" href="applet_2globals_8h.html#5abc5420a7f15af7410173395b610ea8">index</a>;    <span class="comment">//skip past whatever we got from the buffer</span>
<a name="l00127"></a>00127 
<a name="l00128"></a>00128   <span class="keywordflow">return</span> completeMessage;
<a name="l00129"></a>00129 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="cfc975251dbc3a8c9a9b11f8df62cc41"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::getRawData" ref="cfc975251dbc3a8c9a9b11f8df62cc41" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void getRawData           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
this just grabs the raw values off the analog to digital converter 
<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00379">379</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="applet_2globals_8h-source.html#l00026">sensor1_bottom</a>, and <a class="el" href="applet_2globals_8h-source.html#l00025">sensor1_top</a>.</p>

<p>Referenced by <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00389">getTemperatures()</a>, and <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00103">sample()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00380"></a>00380 {
<a name="l00381"></a>00381   <a class="code" href="applet_2globals_8h.html#eb723e2da6dfcdda2972ff176b4aade2">sensor1_top</a>=analogRead(0);
<a name="l00382"></a>00382   <a class="code" href="applet_2globals_8h.html#c0cf7a4f555cb76b1b42a5ec73a1f582">sensor1_bottom</a>=analogRead(1);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384   <span class="comment">/*  uncomment if I enable 2-sensing elements per sensor</span>
<a name="l00385"></a>00385 <span class="comment">   sensor2_top=analogRead(2);</span>
<a name="l00386"></a>00386 <span class="comment">   sensor2_bottom=analogRead(3);*/</span>
<a name="l00387"></a>00387 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ea28af0c7128421a38589128bb39ef1c"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::getTemperatures" ref="ea28af0c7128421a38589128bb39ef1c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void getTemperatures           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00371">371</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00408">convertToResistance()</a>, <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00419">convertToTemperature()</a>, and <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00397">getRawData()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00372"></a>00372 {
<a name="l00373"></a>00373   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#cfc975251dbc3a8c9a9b11f8df62cc41" title="this just grabs the raw values off the analog to digital converter">getRawData</a>();
<a name="l00374"></a>00374   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#8e666a34a083b1806167ca991be0c436" title="this function converts the raw ADC values from the thermistor into resistances of...">convertToResistance</a>();
<a name="l00375"></a>00375   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#3aa4f99331713009a70ee34eba83754b">convertToTemperature</a>();
<a name="l00376"></a>00376 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f6c9587ccbcf223f8c79f508c2fef366"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::initializeSensor" ref="f6c9587ccbcf223f8c79f508c2fef366" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initializeSensor           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
this function configures all the digital communication pins as input or output pins 
<p>
If you adapt this code to work with another sensor or board, you should replace the code in <a class="el" href="applet_2temperature__sensor__board__v2_8h.html#f6c9587ccbcf223f8c79f508c2fef366" title="this function configures all the digital communication pins as input or output pins...">initializeSensor()</a> to initialize all your relevant pins 
<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00350">350</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="applet_2temperature__sensor__board__v2_8h-source.html#l00021">LED</a>, <a class="el" href="applet_2temperature__sensor__board__v2_8h-source.html#l00020">SAMPLE_BUTTON</a>, <a class="el" href="applet_2temperature__sensor__board__v2_8h-source.html#l00019">XBEE_SLEEP</a>, and <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00383">xbeeWake()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00351"></a>00351 {
<a name="l00352"></a>00352   pinMode(<a class="code" href="applet_2temperature__sensor__board__v2_8h.html#658c2878485cfe5cc625d283a6d34bc1">XBEE_SLEEP</a>,OUTPUT);
<a name="l00353"></a>00353   pinMode(<a class="code" href="applet_2temperature__sensor__board__v2_8h.html#b2de299215608c2a35f0feb86adc2f6f">SAMPLE_BUTTON</a>,INPUT);
<a name="l00354"></a>00354   pinMode(<a class="code" href="applet_2temperature__sensor__board__v2_8h.html#eb7a7ba1ab7e0406f1b5ab36d579f585">LED</a>,OUTPUT);
<a name="l00355"></a>00355   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#884c5dd8e3bb500063c819db197db666">xbeeWake</a>();
<a name="l00356"></a>00356 }  
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="fe461d27b9c48d5921c00d521181f12f"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::loop" ref="fe461d27b9c48d5921c00d521181f12f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loop           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00079">79</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00103">sample()</a>, and <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00317">waitForSampleInterval()</a>.</p>

<p>Referenced by <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00427">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00080"></a>00080 {
<a name="l00081"></a>00081   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#b4dbd8380e5d93ead613cf38e6083b7f" title="this function waits for the time specified by the global variables &amp;#39;hours,&amp;#39;...">waitForSampleInterval</a>();
<a name="l00082"></a>00082   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#50a2ce599e896bfb535e70a42003ed23">sample</a>();
<a name="l00083"></a>00083 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="50a2ce599e896bfb535e70a42003ed23"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::sample" ref="50a2ce599e896bfb535e70a42003ed23" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sample           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00085">85</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00408">convertToResistance()</a>, <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00419">convertToTemperature()</a>, <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00397">getRawData()</a>, <a class="el" href="applet_2globals_8h-source.html#l00016">sampleNumber</a>, and <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00151">sendData()</a>.</p>

<p>Referenced by <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00097">loop()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00086"></a>00086 {
<a name="l00087"></a>00087   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#cfc975251dbc3a8c9a9b11f8df62cc41" title="this just grabs the raw values off the analog to digital converter">getRawData</a>();
<a name="l00088"></a>00088   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#8e666a34a083b1806167ca991be0c436" title="this function converts the raw ADC values from the thermistor into resistances of...">convertToResistance</a>();
<a name="l00089"></a>00089   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#3aa4f99331713009a70ee34eba83754b">convertToTemperature</a>();
<a name="l00090"></a>00090   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#95b1b253ee46df6a93285803cf1f3370" title="this function takes care of putting together a message string, calculating a checksum...">sendData</a>();
<a name="l00091"></a>00091   <a class="code" href="applet_2globals_8h.html#b70b476584326d0e035cead4222998ee">sampleNumber</a>++;
<a name="l00092"></a>00092 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="95b1b253ee46df6a93285803cf1f3370"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::sendData" ref="95b1b253ee46df6a93285803cf1f3370" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendData           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
this function takes care of putting together a message string, calculating a checksum, sending it out to the computer and making sure the computer got it ok 
<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00133">133</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="applet_2communications__definitions_8h-source.html#l00009">ACKNOWLEDGE</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00010">ACKNOWLEDGE_AND_CONFIGURE</a>, <a class="el" href="applet_2nublogger_8h-source.html#l00015">configure()</a>, <a class="el" href="applet_2globals_8h-source.html#l00001">FALSE</a>, <a class="el" href="applet_2communications_8h-source.html#l00004">getByte()</a>, <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00184">getChecksum()</a>, <a class="el" href="applet_2globals_8h-source.html#l00005">message</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00021">MESSAGE_END</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00020">MESSAGE_START</a>, <a class="el" href="applet_2communications__definitions_8h-source.html#l00006">NUM_TRIES</a>, <a class="el" href="applet_2globals_8h-source.html#l00016">sampleNumber</a>, <a class="el" href="applet_2globals_8h-source.html#l00035">sensor1_temperature</a>, and <a class="el" href="applet_2globals_8h-source.html#l00002">TRUE</a>.</p>

<p>Referenced by <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00103">sample()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00134"></a>00134 {
<a name="l00135"></a>00135   <span class="keywordtype">char</span> tries=0;
<a name="l00136"></a>00136   <span class="keywordtype">char</span> success=<a class="code" href="applet_2globals_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00137"></a>00137   <span class="keywordtype">int</span> sensor1_temperature_decimals=(<a class="code" href="applet_2globals_8h.html#bffcded031596e15ce3964ab6ebe4f29">sensor1_temperature</a>-(int)<a class="code" href="applet_2globals_8h.html#bffcded031596e15ce3964ab6ebe4f29">sensor1_temperature</a>)*100;    <span class="comment">//sprintf doesn't work for floats, so this hack gets 2 sigfigs</span>
<a name="l00138"></a>00138   <span class="keywordtype">int</span> response=0;
<a name="l00139"></a>00139  <span class="comment">// sprintf(message,"%d", sampleNumber);</span>
<a name="l00140"></a>00140   sprintf(<a class="code" href="applet_2globals_8h.html#a0ec8ae62320ddf9e7b3d84d4cf01522">message</a>, <span class="stringliteral">" %d thermistor 1 = %d.%d degrees C"</span>, <a class="code" href="applet_2globals_8h.html#b70b476584326d0e035cead4222998ee">sampleNumber</a>, (<span class="keywordtype">int</span>)<a class="code" href="applet_2globals_8h.html#bffcded031596e15ce3964ab6ebe4f29">sensor1_temperature</a>, sensor1_temperature_decimals);
<a name="l00141"></a>00141 <span class="comment">//sprintf(message,"%d %d %d", (int) sensor1_temperature, (int) sensor1_resistance, sensor1_temperature_decimals);</span>
<a name="l00142"></a>00142   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> checksum=<a class="code" href="temperature__sensor___terciopelo_8cpp.html#465a79dc430d1e52a5b540920da744ca" title="this computes a checksum of the global string &amp;#39;message&amp;#39;">getChecksum</a>();
<a name="l00143"></a>00143   <span class="keywordflow">while</span>((success==<a class="code" href="applet_2globals_8h.html#a93f0eb578d23995850d61f7d61c55c1">FALSE</a>)&amp;&amp;(tries&lt;<a class="code" href="applet_2communications__definitions_8h.html#1685ca2e434799fb98ea9272ed39d5e3">NUM_TRIES</a>))
<a name="l00144"></a>00144   {
<a name="l00145"></a>00145     Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#53b51d504d04d1bbfb3d4a4f57349480">MESSAGE_START</a>,BYTE);
<a name="l00146"></a>00146     Serial.print(<a class="code" href="applet_2globals_8h.html#a0ec8ae62320ddf9e7b3d84d4cf01522">message</a>);
<a name="l00147"></a>00147     Serial.print(checksum);
<a name="l00148"></a>00148     Serial.print(<a class="code" href="applet_2communications__definitions_8h.html#012714d5d0e7065e355fefe979491541">MESSAGE_END</a>,BYTE);
<a name="l00149"></a>00149     response=<a class="code" href="applet_2communications_8h.html#f8c68e93feeba5b9244094043672bac0">getByte</a>(50);   <span class="comment">//look for the computer's response</span>
<a name="l00150"></a>00150 
<a name="l00151"></a>00151     <span class="keywordflow">if</span>(response==<a class="code" href="applet_2communications__definitions_8h.html#d97232eed56f4b8962167188db8dd2d4" title="these are defined messages sent between the sensor and the computer">ACKNOWLEDGE</a>)   <span class="comment">//the computer got the data.  It's happy, we're happy, we're done!</span>
<a name="l00152"></a>00152       success=<a class="code" href="applet_2globals_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(response==<a class="code" href="applet_2communications__definitions_8h.html#421ea5726b2e7e3464457785964b3c11">ACKNOWLEDGE_AND_CONFIGURE</a>)  <span class="comment">//the computer can ask to upload a new configuration at any sample</span>
<a name="l00155"></a>00155     {
<a name="l00156"></a>00156       success=<a class="code" href="applet_2globals_8h.html#a8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00157"></a>00157       <a class="code" href="applet_2nublogger_8h.html#e369b3765489ee8bd0ea791c1843630f" title="configure() runs if the computer is trying to change the sensor&amp;#39;s sample rate...">configure</a>();
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159     <span class="keywordflow">else</span>         <span class="comment">//if there was a timeout or a checksum mismatch, then re-try</span>
<a name="l00160"></a>00160     tries++;
<a name="l00161"></a>00161   }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4fc01d736fe50cf5b977f755b675f11d"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::setup" ref="4fc01d736fe50cf5b977f755b675f11d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
nublogger temperature sensor Terciopelo(+)<p>
Alex Hornstein 11.19.08 <a href="mailto:alex@nublabs.com">alex@nublabs.com</a> datalogger.nublabs.com<p>
(+)In keeping with the arduino nomenclature, we are naming all our code revisions with Spanish names of venemous snakes. The Terciopelo, or fer-de-lance is a pit viper common in central and northwestern south america. It has a powerful venom that, left untreated, can cause necrosis, brain hemorrhaging, renal failure and death. It's also capable of spraying venom through its fangs for up to 6 feet. Cool, huh? This is a sensor for nublab's datalogging system. The datalogger is a two-part system: There is a USB dongle that plugs into a computer that allows the computer to talk to a wireless Zigbee network, and then there are battery-powered sensors that sense data about the environemnt. The sensors collect data and convert it into human-readable units, and then send the data as plaintext over the wireless network to the computer, where it is stored and logged. Any sensor that will work with this system must implement the <a class="el" href="applet_2nublogger_8h.html#3fdb2350c3f98c0de0f0ae3c831a8b14" title="This function tells the computer of the datalogger&#39;s existence.">discover()</a>, <a class="el" href="applet_2nublogger_8h.html#e369b3765489ee8bd0ea791c1843630f" title="configure() runs if the computer is trying to change the sensor&#39;s sample rate...">configure()</a> and <a class="el" href="temperature__sensor___terciopelo_8cpp.html#50a2ce599e896bfb535e70a42003ed23">sample()</a> functions, as well as be identifiable by a unique name<p>
The <a class="el" href="applet_2nublogger_8h.html#3fdb2350c3f98c0de0f0ae3c831a8b14" title="This function tells the computer of the datalogger&#39;s existence.">discover()</a> function is a short communication sequence when the sensor is first turned on where it broadcasts its name over the network and ensures that the computer recognizes it and is ready to configure it and log its data. The sensor also sends the units of whatever value it will be reporting.<p>
the <a class="el" href="applet_2nublogger_8h.html#e369b3765489ee8bd0ea791c1843630f" title="configure() runs if the computer is trying to change the sensor&#39;s sample rate...">configure()</a> function is triggered by a flag sent by the computer that indicates that the computer would like to change the datalogger's sample rate. <a class="el" href="applet_2nublogger_8h.html#e369b3765489ee8bd0ea791c1843630f" title="configure() runs if the computer is trying to change the sensor&#39;s sample rate...">configure()</a> is another communication sequence in which the computer sends a sample interval in hours, minutes and seconds to the datalogger. By default, the datalogger samples every second.<p>
the <a class="el" href="temperature__sensor___terciopelo_8cpp.html#50a2ce599e896bfb535e70a42003ed23">sample()</a> function is called by the sensor every sample interval. <a class="el" href="temperature__sensor___terciopelo_8cpp.html#50a2ce599e896bfb535e70a42003ed23">sample()</a> reads a value from whatever sensing element (Thermistor, current sensor, light sensor, etc) the particular sensor uses, converts it to physical units (degrees celsius, amps, lux, etc) and sends out a string over the wireless network with the sensor's unique name and its sensed values.<p>
the name: each sensor should have a unique name burnt into its eeprom that makes it uniquely identifiable in the network. Nublabs is using a list of north and south american baby names which is available at datalogger.nublabs.com This particular sensor is a temperature sensor using an NTC thermistor. The thermistor is a resistive element. We sense it using two resistor dividers--one resistor, R1 which connects from Vcc to the thermistor, and another resistor that connects from the other end of the thermistor to ground. We measure the voltage at both ends of the thermistor using separate Analog to Digital Converter (ADC) pins. This allows us to factor out any effect changing battery voltage has on our temperature measurement. This code is written for version 2 of the sensor hardware. A pdf of the sensor schematic and board layout is available at datalogger.nublabs.com 
<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00072">72</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="applet_2nublogger_8h-source.html#l00027">discover()</a>, and <a class="el" href="applet_2temperature__sensor__board__v2_8h-source.html#l00035">initializeSensor()</a>.</p>

<p>Referenced by <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00427">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00073"></a>00073 {
<a name="l00074"></a>00074   Serial.begin(19200);
<a name="l00075"></a>00075   <a class="code" href="applet_2temperature__sensor__board__v2_8h.html#f6c9587ccbcf223f8c79f508c2fef366" title="this function configures all the digital communication pins as input or output pins...">initializeSensor</a>();
<a name="l00076"></a>00076   <a class="code" href="applet_2nublogger_8h.html#3fdb2350c3f98c0de0f0ae3c831a8b14" title="This function tells the computer of the datalogger&amp;#39;s existence.">discover</a>();
<a name="l00077"></a>00077 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="b4dbd8380e5d93ead613cf38e6083b7f"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::waitForSampleInterval" ref="b4dbd8380e5d93ead613cf38e6083b7f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void waitForSampleInterval           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
this function waits for the time specified by the global variables 'hours,' 'minutes,' and 'seconds' It should ideally put the arduino in a power saving mode 
<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00299">299</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="applet_2globals_8h-source.html#l00012">minutes</a>, <a class="el" href="applet_2globals_8h-source.html#l00013">seconds</a>, <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00377">xbeeSleep()</a>, and <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00383">xbeeWake()</a>.</p>

<p>Referenced by <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00097">loop()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00300"></a>00300 {
<a name="l00301"></a>00301   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#a06edc5122b70b3231ff87d8234fe759">xbeeSleep</a>();
<a name="l00302"></a>00302   delay(60*<a class="code" href="applet_2globals_8h.html#b693b677bdc9ded12b06daf49778101c">minutes</a>*1000+<a class="code" href="applet_2globals_8h.html#77bd4f876bdc3afed5acdd936f775d34">seconds</a>*1000);
<a name="l00303"></a>00303   <a class="code" href="temperature__sensor___terciopelo_8cpp.html#884c5dd8e3bb500063c819db197db666">xbeeWake</a>();
<a name="l00304"></a>00304 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="a06edc5122b70b3231ff87d8234fe759"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::xbeeSleep" ref="a06edc5122b70b3231ff87d8234fe759" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void xbeeSleep           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00359">359</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="applet_2temperature__sensor__board__v2_8h-source.html#l00019">XBEE_SLEEP</a>.</p>

<p>Referenced by <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00317">waitForSampleInterval()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00360"></a>00360 {
<a name="l00361"></a>00361   digitalWrite(<a class="code" href="applet_2temperature__sensor__board__v2_8h.html#658c2878485cfe5cc625d283a6d34bc1">XBEE_SLEEP</a>,HIGH);
<a name="l00362"></a>00362 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="884c5dd8e3bb500063c819db197db666"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::xbeeWake" ref="884c5dd8e3bb500063c819db197db666" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void xbeeWake           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00365">365</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

<p>References <a class="el" href="applet_2temperature__sensor__board__v2_8h-source.html#l00019">XBEE_SLEEP</a>.</p>

<p>Referenced by <a class="el" href="applet_2temperature__sensor___terciopelo_8pde-source.html#l00350">initializeSensor()</a>, and <a class="el" href="temperature__sensor___terciopelo_8cpp-source.html#l00317">waitForSampleInterval()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00366"></a>00366 {
<a name="l00367"></a>00367   digitalWrite(<a class="code" href="applet_2temperature__sensor__board__v2_8h.html#658c2878485cfe5cc625d283a6d34bc1">XBEE_SLEEP</a>,LOW);
<a name="l00368"></a>00368 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="8188fea1f6709096fe21a3ee084d00d0"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::B" ref="8188fea1f6709096fe21a3ee084d00d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="temperature__sensor___terciopelo_8pde.html#8188fea1f6709096fe21a3ee084d00d0">B</a> = 3950.0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00339">339</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

</div>
</div><p>
<a class="anchor" name="735577560ca40e5b6008a98829068904"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::R0" ref="735577560ca40e5b6008a98829068904" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="temperature__sensor___terciopelo_8pde.html#735577560ca40e5b6008a98829068904">R0</a> = 10000.0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00338">338</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

</div>
</div><p>
<a class="anchor" name="d17df5990b551ac9e97a3d60f65833ff"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::RBOTTOM" ref="d17df5990b551ac9e97a3d60f65833ff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="temperature__sensor___terciopelo_8pde.html#d17df5990b551ac9e97a3d60f65833ff">RBOTTOM</a> = 1000.0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00341">341</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

</div>
</div><p>
<a class="anchor" name="4211ba1269f650e21964d32238a460b2"></a><!-- doxytag: member="temperature_sensor_Terciopelo.pde::T0" ref="4211ba1269f650e21964d32238a460b2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="temperature__sensor___terciopelo_8pde.html#4211ba1269f650e21964d32238a460b2">T0</a> = 298          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="temperature__sensor___terciopelo_8pde-source.html#l00340">340</a> of file <a class="el" href="temperature__sensor___terciopelo_8pde-source.html">temperature_sensor_Terciopelo.pde</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Nov 20 14:52:51 2008 for temperature sensor by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.7 </small></address>
</body>
</html>
